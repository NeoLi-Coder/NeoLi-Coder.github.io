import{ac as g,ad as c,ae as l,o as u,s as o,af as f,j as m,ag as p,e as B,l as h,ah as b,ai as y,aj as n,ak as d,al as k,am as r}from"./vidstack-4c4227d4-5daa9c9e.js";class A{constructor(t){this.fg=t}Ub(){g(this.nc)&&this.Ij()}Vb(){c(this.nc)&&window.cancelAnimationFrame(this.nc),this.nc=void 0}Ij(){this.nc=window.requestAnimationFrame(()=>{g(this.nc)||(this.fg(),this.Ij())})}}class O{constructor(t,i){this.V=p(),this.pg=!1,this.rg=!1,this.sg=!1,this.qg=new A(this.wg.bind(this)),this.vg=void 0,this.Pg=void 0,this.tb=t,this.Sf=i,this.xg(),B(this.yg.bind(this)),u(this.hg.bind(this))}get B(){return this.tb.media}get Oc(){return this.Sf.delegate}hg(){this.rg=!1,this.sg=!1,this.qg.Vb(),this.V.empty()}wg(){const t=this.tb.currentTime;this.Sf.$state.currentTime()!==t&&this.og(t)}xg(){this.ng("loadstart",this.Af),this.ng("abort",this.ug),this.ng("emptied",this.zg),this.ng("error",this.fd)}Ag(){this.rg||(this.V.add(this.ng("loadeddata",this.Bg),this.ng("loadedmetadata",this.Cg),this.ng("canplay",this._c),this.ng("canplaythrough",this.Dg),this.ng("durationchange",this.Eg),this.ng("play",this.la),this.ng("progress",this.Fg),this.ng("stalled",this.Gg),this.ng("suspend",this.Hg)),this.rg=!0)}Ig(){this.sg||(this.V.add(this.ng("pause",this.ma),this.ng("playing",this.Jg),this.ng("ratechange",this.Kg),this.ng("seeked",this.Lg),this.ng("seeking",this.Mg),this.ng("ended",this.Ng),this.ng("volumechange",this.md),this.ng("waiting",this.Og)),this.sg=!0)}ng(t,i){return h(this.B,t,i.bind(this))}Qg(t){}og(t,i){this.Oc.A("time-update",{detail:{currentTime:Math.min(t,this.Sf.$state.seekableEnd()),played:this.B.played},trigger:i})}Af(t){if(this.B.networkState===3){this.ug(t);return}this.Ag(),this.Oc.A("load-start",{trigger:t})}ug(t){this.Oc.A("abort",{trigger:t})}zg(){this.Oc.A("emptied",{trigger:event})}Bg(t){this.Oc.A("loaded-data",{trigger:t})}Cg(t){this.Ig(),this.Oc.A("volume-change",{detail:{volume:this.B.volume,muted:this.B.muted}}),this.Oc.A("loaded-metadata",{trigger:t}),b&&y(this.Sf.$state.source())&&this.Oc.Rg(this.tg(),t)}tg(){return{duration:this.B.duration,buffered:this.B.buffered,seekable:this.B.seekable}}la(t){this.Sf.$state.canPlay&&this.Oc.A("play",{trigger:t})}ma(t){this.B.readyState===1&&!this.pg||(this.pg=!1,this.qg.Vb(),this.Oc.A("pause",{trigger:t}))}_c(t){this.Oc.Rg(this.tg(),t)}Dg(t){this.Sf.$state.started()||this.Oc.A("can-play-through",{trigger:t,detail:this.tg()})}Jg(t){this.pg=!1,this.Oc.A("playing",{trigger:t}),this.qg.Ub()}Gg(t){this.Oc.A("stalled",{trigger:t}),this.B.readyState<3&&(this.pg=!0,this.Oc.A("waiting",{trigger:t}))}Og(t){this.B.readyState<3&&(this.pg=!0,this.Oc.A("waiting",{trigger:t}))}Ng(t){this.qg.Vb(),this.og(this.B.duration,t),this.Oc.A("end",{trigger:t}),this.Sf.$state.loop()?this.Sg():this.Oc.A("ended",{trigger:t})}yg(){this.Sf.$state.paused()&&h(this.B,"timeupdate",this.Tg.bind(this))}Tg(t){this.og(this.B.currentTime,t)}Eg(t){this.Sf.$state.ended()&&this.og(this.B.duration,t),this.Oc.A("duration-change",{detail:this.B.duration,trigger:t})}md(t){this.Oc.A("volume-change",{detail:{volume:this.B.volume,muted:this.B.muted},trigger:t})}Lg(t){this.og(this.B.currentTime,t),this.Oc.A("seeked",{detail:this.B.currentTime,trigger:t}),Math.trunc(this.B.currentTime)===Math.trunc(this.B.duration)&&n(this.B.duration)>n(this.B.currentTime)&&(this.og(this.B.duration,t),this.B.ended||this.Sf.player.dispatch(new d("media-play-request",{trigger:t})))}Mg(t){this.Oc.A("seeking",{detail:this.B.currentTime,trigger:t})}Fg(t){this.Oc.A("progress",{detail:{buffered:this.B.buffered,seekable:this.B.seekable},trigger:t})}Sg(){k(this.B.controls)&&(this.B.controls=!1),this.Sf.player.dispatch(new d("media-loop-request"))}Hg(t){this.Oc.A("suspend",{trigger:t})}Kg(t){this.Oc.A("rate-change",{detail:this.B.playbackRate,trigger:t})}fd(t){const i=this.B.error;i&&this.Oc.A("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class T{constructor(t,i){this.tb=t,this.gg=i,this.Ug.onaddtrack=this.Wg.bind(this),this.Ug.onremovetrack=this.Xg.bind(this),this.Ug.onchange=this.Yg.bind(this),h(this.gg.audioTracks,"change",this.Zg.bind(this))}get Ug(){return this.tb.media.audioTracks}Wg(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.gg.audioTracks[r.h](s,t),i.enabled&&(s.selected=!0)}Xg(t){const i=this.gg.audioTracks.getById(t.track.id);i&&this.gg.audioTracks[r.f](i,t)}Yg(t){let i=this.Vg();if(!i)return;const s=this.gg.audioTracks.getById(i.id);s&&this.gg.audioTracks[r.Y](s,!0,t)}Vg(){return Array.from(this.Ug).find(t=>t.enabled)}Zg(t){const{current:i}=t.detail;if(!i)return;const s=this.Ug.getTrackById(i.id);if(s){const e=this.Vg();e&&(e.enabled=!1),s.enabled=!0}}}class w{constructor(t){this.scope=l(),this.C=null,this.B=t}setup(t){new O(this,t),"audioTracks"in this.media&&new T(this,t);const{muted:i,volume:s,playsinline:e}=t.$state;this.muted=i(),this.volume=s(),this.playsinline=e(),u(()=>{this.B.setAttribute("src",""),this.B.load()})}get type(){return""}get media(){return this.B}get currentSrc(){return this.C}get paused(){return this.B.paused}get muted(){return this.B.muted}set muted(t){this.B.muted=t}get volume(){return this.B.volume}set volume(t){this.B.volume=t}get currentTime(){return this.B.currentTime}set currentTime(t){this.B.currentTime=t}get playsinline(){return this.B.hasAttribute("playsinline")}set playsinline(t){o(this.B,"playsinline",t)}get playbackRate(){return this.B.playbackRate}set playbackRate(t){this.B.playbackRate=t}async play(){return this.B.play()}async pause(){return this.B.pause()}async loadSource({src:t,type:i},s){this.B.preload=s||"",f(t)?this.B.srcObject=t:(this.B.srcObject=null,this.B.src=m(t)?t:window.URL.createObjectURL(t)),this.B.load(),this.C={src:t,type:i}}}export{w as H,A as R};
